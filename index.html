<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Income Expense App</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>

<form onsubmit="addTransaction(event)">
<input type="date" id="date" required>
<input type="text" id="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" required>

<select id="type">
<option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
<option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
</select>

<input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" required>
<button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</form>

<div class="summary">
<p>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°: <span id="totalIncome">0</span> ‡∏ö‡∏≤‡∏ó</p>
<p>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°: <span id="totalExpense">0</span> ‡∏ö‡∏≤‡∏ó</p>
<p>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="balance">0</span> ‡∏ö‡∏≤‡∏ó</p>
</div>

<h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

<table border="1" width="100%" id="transactionTable">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
<th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
<th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
<th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

</div>

<script>
// üîê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
const isLoggedIn = localStorage.getItem("loggedIn");
const currentUser = localStorage.getItem("user");

if(isLoggedIn !== "true"){
window.location.href = "login.html";
}

// üì¶ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á user ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
let transactions = JSON.parse(localStorage.getItem(currentUser + "_transactions")) || [];

function addTransaction(event){
event.preventDefault();

const date = document.getElementById("date").value;
const detail = document.getElementById("detail").value;
const type = document.getElementById("type").value;
const amount = parseFloat(document.getElementById("amount").value);

const newItem = { date, detail, type, amount };

transactions.push(newItem);

localStorage.setItem(currentUser + "_transactions", JSON.stringify(transactions));

renderTable();
calculate();
event.target.reset();
}

function renderTable(){
const tbody = document.querySelector("#transactionTable tbody");
tbody.innerHTML = "";

transactions.forEach((item, index) => {
const row = `
<tr>
<td>${item.date}</td>
<td>${item.detail}</td>
<td>${item.type === "income" ? "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö" : "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢"}</td>
<td>${item.amount}</td>
<td><button onclick="deleteItem(${index})">‡∏•‡∏ö</button></td>
</tr>
`;
tbody.innerHTML += row;
});
}

function deleteItem(index){
transactions.splice(index, 1);
localStorage.setItem(currentUser + "_transactions", JSON.stringify(transactions));
renderTable();
calculate();
}

function calculate(){
let income = 0;
let expense = 0;

transactions.forEach(item => {
if(item.type === "income"){
income += item.amount;
}else{
expense += item.amount;
}
});

document.getElementById("totalIncome").innerText = income;
document.getElementById("totalExpense").innerText = expense;
document.getElementById("balance").innerText = income - expense;
}

function logout(){
localStorage.removeItem("loggedIn");
window.location.href = "login.html";
}

renderTable();
calculate();
</script>

</body>
</html>
